var app=angular.module("app",["ngMaterial"]);app.service("transactionsService",["$http","$q",function(n,t){this.service=function(e,i,a){var r=t.defer();return setTimeout(function(){n({method:e,url:"http://localhost:3000/"+i,data:a}).then(function(n){r.resolve(n.data)},function(n){r.reject(n.statusText)})},50),r.promise}}]),app.directive("transactionsEdit",function(){return{restrict:"A",require:"^transactionsTable",scope:!0,link:function(n,t,e,i){var a=$(t).find(".transaction-data"),r=$(t).find(".transaction-edit-trigger"),o=$(t).find(".transaction-edit"),c=$(t).find(".transaction-sync"),s=!1;r.hide(),o.hide(),c.hide(),$(t).bind("mouseover",function(){s||r.fadeIn()}),$(t).bind("mouseleave",function(){s||r.fadeOut()}),$(r).bind("click",function(){a.fadeOut().promise().done(function(){s=!0,o.fadeIn(),r.hide()})}),n.save=function(n,t){t&&t.preventDefault(),o.fadeOut().promise().done(function(){c.fadeIn().promise().done(function(){i.edit(n).then(function(){c.fadeOut().promise().done(function(){a.fadeIn(500).promise().done(function(){s=!1,r.show()})})})})})}}}}),app.directive("transactionsSearch",function(){return{restrict:"E",replace:!0,templateUrl:"app/components/transactions/search/view.html",require:"?transactionsTable",link:function(n,t,e,i){}}}),app.directive("transactionsTable",function(){return{restrict:"E",replace:!0,templateUrl:"app/components/transactions/table/view.html",controller:function(n,t,e){function i(){t.service("GET","categories").then(function(t){n.categories=t}),t.service("GET","status").then(function(t){n.status=t}),t.service("GET","accounts").then(function(t){n.accounts=t}),t.service("GET","transactions").then(function(t){n.headers=["Date","Description","Account","Category","Amount","Balance","Status"],n.transactions=t,n.loading=!1})}function a(i,a,r){var o=e.defer();return t.service(i,a,r).then(function(){t.service("GET","transactions").then(function(t){n.transactions=t,o.resolve()})}),o.promise}n.loading=!0,i(),this.add=function(n){return a("POST","transactions/",n)},this.edit=function(n){return a("PUT","transactions/"+n.id,n)};var r=[];n.checked=function(n){-1!==r.indexOf(n.id)?r.splice(r.indexOf(n.id),1):r.push(n.id)},this["delete"]=function(){var n=e.defer(),t=[];return angular.forEach(r,function(n){t.push(a("DELETE","transactions/"+n))}),e.all(t).then(function(){r=[],n.resolve()}),n.promise},n.transformDate=function(n){return new Date(n)},n.formatDate=function(n){return n.getMonth()+1+"/"+n.getDate()+"/"+n.getFullYear()}},link:function(n,t,e,i){var a=$(t).find(".transactions.delete .transaction-delete"),r=$(t).find(".transactions.delete .transaction-sync");r.hide(),n["delete"]=function(){a.fadeOut().promise().done(function(){r.fadeIn().promise().done(function(){i["delete"]().then(function(){r.fadeOut().promise().done(function(){a.fadeIn()})})})})}}}}),app.directive("transactionsAdd",function(){return{restrict:"E",replace:!0,scope:!0,templateUrl:"app/components/transactions/add/view.html",require:"^transactionsTable",link:function(n,t,e,i){function a(){var t=!0;return""===n.transaction.description&&(t=!1),0===n.transaction.amount&&(t=!1),t}var r=($(t).find(".transaction-form"),$(t).find(".transaction-sync"));r.hide();var o=new Date;n.transaction={date:o,description:"",accountId:0,categoryId:0,statusId:0,parentId:0},n.add=function(t){t.preventDefault(),a()&&r.fadeIn().promise().done(function(){i.add(n.transaction).then(function(){r.fadeOut()})})}}}});