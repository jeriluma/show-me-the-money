var app=angular.module("app",["ngMaterial"]);app.service("transactionsService",["$http","$q",function(n,t){this.service=function(e,a,r){var i=t.defer();return setTimeout(function(){n({method:e,url:"http://localhost:3000/"+a,data:r}).then(function(n){i.resolve(n.data)},function(n){i.reject(n.statusText)})},50),i.promise}}]),app.directive("transactionsAdd",function(){return{restrict:"E",replace:!0,scope:!0,templateUrl:"app/components/transactions/add/view.html",require:"^transactionsTable",link:function(n,t,e,a){function r(){var t=!0;return""===n.transaction.description&&(t=!1),0===n.transaction.amount&&(t=!1),t}var i=($(t).find(".transaction-form"),$(t).find(".transaction-sync")),o=$(t).find(".transaction-submit");i.hide();var c=new Date;n.transaction={date:c,description:"",accountId:0,categoryId:0,statusId:0,parentId:0},n.add=function(t){t.preventDefault(),r()&&o.fadeOut().promise().done(function(){i.fadeIn().promise().done(function(){a.add(n.transaction).then(function(){i.fadeOut().promise().done(function(){o.fadeIn()})})})})}}}}),app.directive("transactionsEdit",function(){return{restrict:"A",require:"^transactionsTable",scope:!0,link:function(n,t,e,a){var r=$(t).find(".transaction-data"),i=$(t).find(".transaction-edit-trigger"),o=$(t).find(".transaction-edit"),c=$(t).find(".transaction-sync"),s=!1,d=!1;i.hide(),o.hide(),c.hide(),$(t).bind("mouseover",function(){$(t).removeClass("pointer"),d||($(t).addClass("pointer"),i.fadeIn().promise().done(function(){s=!0}))}),$(t).bind("mouseleave",function(){$(t).removeClass("pointer"),d||($(t).addClass("pointer"),i.fadeOut().promise().done(function(){s=!1}))}),$(t).bind("click",function(){s&&(d=!0,s=!1,i.hide().promise().done(function(){r.fadeOut().promise().done(function(){o.fadeIn()})}))}),n.save=function(n,t){t&&t.preventDefault(),o.fadeOut().promise().done(function(){c.fadeIn().promise().done(function(){a.edit(n).then(function(){c.fadeOut().promise().done(function(){r.fadeIn(500).promise().done(function(){d=!1,i.show()})})})})})}}}}),app.directive("transactionsSearch",function(){return{restrict:"E",replace:!0,templateUrl:"app/components/transactions/search/view.html",require:"^transactionsTable",link:function(n,t,e,a){var r=$(t).find(".transaction-sync"),i=$(t).find(".transaction-search-element");r.hide();var o=new Date;n.transaction={date:{start:null,end:o},description:"",accountId:"",categoryId:"",statusId:""},n.search=function(t){t&&t.preventDefault(),i.fadeOut().promise().done(function(){a.hideTable().then(function(){r.fadeIn().promise().done(function(){a.search(n.transaction).then(function(){r.fadeOut().promise().done(function(){i.fadeIn(),a.showTable()})})})})})}}}}),app.filter("filterSearchTransaction",["$filter","$q",function(n,t){return function(t,e){var a=[];return angular.forEach(t,function(n){n.date=new Date(n.date);var t=null===e.date.start||n.date>=e.date.start,r=n.date<=e.date.end,i=""===e.accountId||n.accountId===e.accountId,o=""===e.categoryId||n.categoryId===e.categoryId,c=""===e.statusId||n.statusId===e.statusId;t&&r&&i&&o&&c&&a.push(n)}),""!==e.description&&(a=n("filter")(a,e.description)),a}}]),app.directive("transactionsSummary",function(){return{restrict:"E",replace:!0,templateUrl:"app/components/transactions/summary/view.html",controller:function(n,t,e,a){n.balance={overall:"",debit:"",credit:""},this.init=function(){var r=a.defer();return t.service("GET","transactions?accountId=0").then(function(a){var i={overall:0,debit:0,credit:0};angular.forEach(a,function(n){i.debit+=n.amount}),t.service("GET","transactions?accountId=1").then(function(t){angular.forEach(t,function(n){i.credit+=n.amount}),i.overall=i.debit-i.credit,i.overall=e("currency")(i.overall,"$"),i.debit=e("currency")(i.debit,"$"),i.credit=e("currency")(i.credit,"$"),n.balance=i,r.resolve()})}),r.promise}},link:function(n,t,e,a){var r=$(t).find("p");r.hide(),a.init().then(function(){r.fadeIn()})}}}),app.directive("transactionsTable",function(){return{restrict:"E",replace:!0,templateUrl:"app/components/transactions/table/view.html",controller:function(n,t,e,a){function r(){var a=e.defer(),r=[];return r.push(n.loading=!0),t.service("GET","categories").then(function(t){r.push(n.categories=t)}),t.service("GET","status").then(function(t){r.push(n.status=t)}),t.service("GET","accounts").then(function(t){r.push(n.accounts=t)}),e.all(r).then(function(){a.resolve()}),a.promise}function i(t){for(var a=e.defer(),r=0,i=1,o=t.length-1;o>=0;o--){var c=t[o];i=n.categories[c.categoryId]&&"Expense"===n.categories[c.categoryId].parentId?-1:1,c.balance=r+i*c.amount,r=c.balance}return a.resolve(t),a.promise}function o(a,r,o){var c=e.defer();return t.service(a,r,o).then(function(){t.service("GET","transactions?_sort=date&_order=DESC").then(function(t){i(t).then(function(t){n.transactions=t,c.resolve()})})}),c.promise}n.categories=[],n.status=[],n.accounts=[],n.headers=[],r().then(function(){t.service("GET","transactions?_sort=date&_order=DESC").then(function(t){i(t).then(function(t){n.headers=["Date","Description","Account","Category","Amount","Balance","Status"],n.transactions=t,n.loading=!1})})}),n.transformDate=function(n){return new Date(n)},n.formatDate=function(n){return n.getMonth()+1+"/"+n.getDate()+"/"+n.getFullYear()},this.add=function(n){return o("POST","transactions/",n)};var c=!1;this.edit=function(n){var t=e.defer();return c=!0,o("PUT","transactions/"+n.id,n).then(function(){c=!1,t.resolve()}),t.promise},this.isEditing=function(){return c===!0};var s=[];n.checked=function(n){-1!==s.indexOf(n.id)?s.splice(s.indexOf(n.id),1):s.push(n.id)},this.hasCheckedIds=function(){return s.length>0},this["delete"]=function(){var n=e.defer(),t=[];return angular.forEach(s,function(n){t.push(o("DELETE","transactions/"+n))}),e.all(t).then(function(){s=[],n.resolve()}),n.promise};var d=[];this.search=function(n){var r=e.defer();return t.service("GET","transactions?_sort=date&_order=DESC").then(function(t){i(t).then(function(t){r.resolve(d=a("filterSearchTransaction")(t,n))})}),r.promise},this.hideTable=function(){var t=e.defer();return n.transactions=[],n.$apply(),t.resolve(),t.promise},this.showTable=function(){n.transactions=d,n.$apply()}},link:function(n,t,e,a){var r=$(t).find(".transaction-delete"),i=$(t).find(".transaction-sync");i.hide(),n["delete"]=function(){a.hasCheckedIds()&&r.fadeOut().promise().done(function(){i.fadeIn().promise().done(function(){a["delete"]().then(function(){i.fadeOut().promise().done(function(){r.fadeIn()})})})})}}}});