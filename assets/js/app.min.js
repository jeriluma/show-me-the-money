var app=angular.module("app",["ngMaterial"]);app.service("transactionsService",["$http","$q","$rootScope",function(t,n,e){this.service=function(e,a,i){var r=n.defer();return t({method:e,url:"http://localhost:3000/"+a,data:i}).then(function(t){r.resolve(t.data)},function(t){r.reject(t.statusText)}),r.promise};var a=0;this.setUpdateStatus=function(t){a=t,e.$broadcast("transactions:updated",!0)},this.getUpdateStatus=function(){return a};var i=0;this.setSearchStatus=function(t){i=t,e.$broadcast("transactions:search",!0)},this.getSearchStatus=function(){return i};var r={};this.setFilterProperties=function(t){var e=n.defer();return e.resolve(r=t),e.promise},this.getFilterProperties=function(){return r}}]),app.directive("transactionsDelete",["transactionsService",function(t){return{restrict:"A",scope:!0,controller:function(t,n,e){this.deleteData=function(t,a){var i=e.defer(),r=a.description,o=n.confirm().title("Would you like to delete this transaction?").textContent(r).ariaLabel(a.description).targetEvent(t).ok("Yes").cancel("No");return n.show(o).then(function(){i.resolve("delete")},function(){i.resolve("cancel")}),i.promise}},link:function(n,e,a,i){var r=$(e).find(".transaction-delete-trigger"),o=$(e).find(".transaction-sync"),c=!1;r.hide(),o.hide(),$(e).bind("mouseover",function(){c||r.fadeIn()}),$(e).bind("mouseleave",function(){c||r.fadeOut()}),n["delete"]=function(n,e){c=!0,r.fadeIn().promise().then(function(){i.deleteData(n,e).then(function(n){"delete"===n?r.fadeOut().promise().then(function(){o.fadeIn().promise().then(function(){t.service("DELETE","transactions/"+e.id).then(function(){t.setUpdateStatus(1),c=!1})})}):r.fadeOut().promise().then(function(){c=!1})})})}}}}]),app.directive("transactionsSummary",function(){return{restrict:"E",replace:!0,templateUrl:"app/components/transactions/summary/view.html",controller:function(t,n,e,a){t.balance={overall:"",debit:"",credit:""},this.init=function(){var i=a.defer();return n.service("GET","transactions?accountId=0&statusId=1&statusId=2").then(function(a){var r={overall:0,debit:0,credit:0};angular.forEach(a,function(t){r.debit+=t.amount}),n.service("GET","transactions?accountId=1&statusId=1&statusId=3").then(function(n){angular.forEach(n,function(t){r.credit+=t.amount}),r.overall=r.debit-r.credit,r.overall=e("currency")(r.overall,"$"),r.debit=e("currency")(r.debit,"$"),r.credit=e("currency")(r.credit,"$"),t.balance=r,i.resolve()})}),i.promise}},link:function(t,n,e,a){var i=$(n).find("p");i.hide(),a.init().then(function(){i.fadeIn()})}}}),app.directive("transactionsSearch",["transactionsService",function(t){return{restrict:"E",replace:!0,templateUrl:"app/components/transactions/search/view.html",controller:function(n,e,a){function i(){var e=a.defer(),i=[];return t.service("GET","categories").then(function(t){i.push(n.categories=t)}),t.service("GET","status").then(function(t){i.push(n.status=t)}),t.service("GET","accounts").then(function(t){i.push(n.accounts=t)}),a.all(i).then(function(){e.resolve()}),e.promise}n.categories=[],n.status=[],n.accounts=[],n.headers=["Date","Description","Account","Category","Amount","Balance","Status"],n.transactions=[];var r=new Date;n.filterProperties={date:{start:null,end:r},description:"",accountId:"",categoryId:"",statusId:""},i()},link:function(n,e,a,i){var r=$(e).find(".transaction-sync"),o=$(e).find(".transaction-search-element"),c=!1;r.hide(),n.search=function(e){e&&e.preventDefault(),o.fadeOut().promise().done(function(){r.fadeIn().promise().done(function(){t.setFilterProperties(n.filterProperties).then(function(){c=!0,t.setSearchStatus(1)})})})},n.$on("transactions:search",function(e,a){2===t.getSearchStatus()&&c&&r.fadeOut().promise().done(function(){o.fadeIn().promise().done(function(){c=!1;var e=new Date;n.filterProperties={date:{start:null,end:e},description:"",accountId:"",categoryId:"",statusId:""},n.$apply(),t.setSearchStatus(0)})})})}}}]),app.filter("filterSearchTransaction",["$filter","$q",function(t){return function(n,e){var a=[];return angular.forEach(n,function(t){t.date=new Date(t.date);var n=null===e.date.start||t.date>=e.date.start,i=t.date<=e.date.end,r=""===e.accountId||t.accountId===e.accountId,o=""===e.categoryId||t.categoryId===e.categoryId,c=""===e.statusId||t.statusId===e.statusId;n&&i&&r&&o&&c&&a.push(t)}),""!==e.description&&(a=t("filter")(a,e.description)),a}}]),app.directive("transactionsEdit",function(){return{restrict:"A",scope:!0,controller:function(t,n,e){this.isValid=function(t){return t==t},this.updateData=function(t){e.service("PUT","transactions/"+t.id,t).then(function(){e.setUpdateStatus(1)})}},link:function(t,n,e,a){var i=$(n).find(".transaction-data"),r=$(n).find(".transaction-edit-trigger"),o=$(n).find(".transaction-edit"),c=$(n).find(".transaction-sync"),s=!1,u=!1;r.hide(),o.hide(),c.hide(),$(n).bind("mouseover",function(){$(n).removeClass("pointer"),u||($(n).addClass("pointer"),r.fadeIn().promise().done(function(){s=!0}))}),$(n).bind("mouseleave",function(){$(n).removeClass("pointer"),u||($(n).addClass("pointer"),r.fadeOut().promise().done(function(){s=!1}))}),$(n).bind("click",function(){s&&(u=!0,s=!1,r.hide().promise().done(function(){i.fadeOut().promise().done(function(){o.fadeIn()})}))}),t.save=function(t,n){n&&n.preventDefault(),a.isValid(t)&&o.fadeOut().promise().done(function(){c.fadeIn().promise().done(function(){a.updateData(t)})})}}}}),app.directive("transactionsTable",function(){return{restrict:"E",replace:!0,scope:{type:"@"},templateUrl:"app/components/transactions/table/view.html",controller:function(t,n,e,a){function i(){var a=e.defer(),i=[];return n.service("GET","categories").then(function(n){t.categories=n,i.push()}),n.service("GET","status").then(function(n){i.push(t.status=n)}),n.service("GET","accounts").then(function(n){i.push(t.accounts=n)}),e.all(i).then(function(){a.resolve()}),a.promise}function r(n){for(var a=e.defer(),i=0,r=1,o=n.length-1;o>=0;o--){var c=n[o];r=t.categories[c.categoryId]&&"Expense"===t.categories[c.categoryId].parentId?-1:1,c.balance=i+r*c.amount,i=c.balance}return a.resolve(n),a.promise}t.categories=[],t.status=[],t.accounts=[],t.headers=["Date","Description","Account","Category","Amount","Balance","Status"],i().then(function(){"search"!==t.type&&n.service("GET","transactions?_sort=date&_order=DESC").then(function(n){r(n).then(function(n){t.transactions=n})})}),t.transformDate=function(t){return new Date(t)},t.$on("transactions:updated",function(e,a){1===n.getUpdateStatus()&&"search"!==t.type&&n.service("GET","transactions?_sort=date&_order=DESC").then(function(e){r(e).then(function(e){t.transactions=e,n.setUpdateStatus(2)})})}),t.$on("transactions:search",function(e,i){1===n.getSearchStatus()&&n.service("GET","transactions?_sort=date&_order=DESC").then(function(e){r(e).then(function(e){t.transactions=a("filterSearchTransaction")(e,n.getFilterProperties()),n.setSearchStatus(2)})})})},link:function(t,n,e,a){}}}),app.directive("transactionsAdd",["transactionsService",function(t){return{restrict:"E",replace:!0,templateUrl:"app/components/transactions/add/view.html",controller:function(n,e){function a(){var a=e.defer(),i=[];return t.service("GET","categories").then(function(t){i.push(n.categories=t)}),t.service("GET","status").then(function(t){i.push(n.status=t)}),t.service("GET","accounts").then(function(t){i.push(n.accounts=t)}),e.all(i).then(function(){a.resolve()}),a.promise}var i=new Date;n.transaction={date:i,description:"",accountId:0,categoryId:0,statusId:0,parentId:0,amount:null},a(),this.isValid=function(){return""!==n.transaction.description&&0!==n.transaction.amount},n.isUpdating=!1,this.updateData=function(){t.service("POST","transactions/",n.transaction).then(function(){n.isUpdating=!0,t.setUpdateStatus(1)})},this.updateDone=function(){n.isUpdating=!1,t.setUpdateStatus(0);var e=new Date;n.transaction={date:e,description:"",accountId:0,categoryId:0,statusId:0,parentId:0,amount:null},n.$apply()}},link:function(n,e,a,i){var r=($(e).find(".transaction-form"),$(e).find(".transaction-sync")),o=$(e).find(".transaction-submit");r.hide(),n.add=function(t){t.preventDefault(),i.isValid()&&o.fadeOut().promise().done(function(){r.fadeIn().promise().done(function(){i.updateData()})})},n.$on("transactions:updated",function(e,a){2===t.getUpdateStatus()&&n.isUpdating&&r.fadeOut().promise().then(function(){o.fadeIn().promise().then(function(){i.updateDone()})})})}}}]),app.directive("transactionsTransactions",function(){return{restrict:"E",replace:!0,templateUrl:"app/components/transactions/transactions/view.html",controller:function(t){},link:function(t,n,e,a){}}});